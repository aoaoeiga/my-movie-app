<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>æ˜ ç”»è¨ºæ–­ã‚¢ãƒ—ãƒª</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
</head>
<body>
  <div id="root"></div>
  <script type="text/babel">
    const { useState } = React;

    function MovieFinderApp() {
      const [step, setStep] = useState(0);
      const [answers, setAnswers] = useState({});
      const [movie, setMovie] = useState(null);
      const [loading, setLoading] = useState(false);

      const questions = [
        {
          id: 'type',
          question: 'ã‚¢ãƒ‹ãƒ¡ï¼Ÿå®Ÿå†™ï¼Ÿ',
          emoji: 'ğŸ¬',
          options: [
            { value: 'anime', label: 'ã‚¢ãƒ‹ãƒ¡', emoji: 'ğŸ¨' },
            { value: 'live', label: 'å®Ÿå†™', emoji: 'ğŸ¬' }
          ]
        },
        {
          id: 'award',
          question: 'å—è³ä½œå“ã‚’è¦‹ãŸã„ï¼Ÿ',
          emoji: 'ğŸ†',
          options: [
            { value: 'yes', label: 'å—è³ä½œå“', emoji: 'ğŸ†' },
            { value: 'no', label: 'äººæ°—ä½œå“', emoji: 'âœ¨' }
          ]
        },
        {
          id: 'genre',
          question: 'å¥½ããªã‚¸ãƒ£ãƒ³ãƒ«ã¯ï¼Ÿ',
          emoji: 'ğŸ­',
          options: [
            { value: 'action', label: 'ã‚¢ã‚¯ã‚·ãƒ§ãƒ³', emoji: 'ğŸ’¥' },
            { value: 'comedy', label: 'ã‚³ãƒ¡ãƒ‡ã‚£', emoji: 'ğŸ˜‚' },
            { value: 'horror', label: 'ãƒ›ãƒ©ãƒ¼', emoji: 'ğŸ‘»' },
            { value: 'romance', label: 'æ‹æ„›', emoji: 'ğŸ’•' },
            { value: 'scifi', label: 'SF', emoji: 'ğŸš€' },
            { value: 'drama', label: 'ãƒ‰ãƒ©ãƒ', emoji: 'ğŸ­' }
          ]
        },
        {
          id: 'mood',
          question: 'ä»Šã®æ°—åˆ†ã¯ï¼Ÿ',
          emoji: 'ğŸ˜Š',
          options: [
            { value: 'exciting', label: 'ãƒ¯ã‚¯ãƒ¯ã‚¯', emoji: 'ğŸ¤©' },
            { value: 'calm', label: 'ã—ã£ã¨ã‚Š', emoji: 'ğŸŒ™' },
            { value: 'thrilling', label: 'ãƒ‰ã‚­ãƒ‰ã‚­', emoji: 'ğŸ’“' },
            { value: 'funny', label: 'ç¬‘ã„ãŸã„', emoji: 'ğŸ˜†' }
          ]
        },
        {
          id: 'language',
          question: 'è¨€èªã¯ï¼Ÿ',
          emoji: 'ğŸŒ',
          options: [
            { value: 'ja', label: 'æ—¥æœ¬èª', emoji: 'ğŸ‡¯ğŸ‡µ' },
            { value: 'en', label: 'è‹±èª', emoji: 'ğŸ‡ºğŸ‡¸' },
            { value: 'other', label: 'ãã®ä»–', emoji: 'ğŸŒ' }
          ]
        },
        {
          id: 'runtime',
          question: 'è¦–è´æ™‚é–“ã¯ï¼Ÿ',
          emoji: 'â±ï¸',
          options: [
            { value: 'short', label: 'çŸ­ã‚ (90åˆ†ä»¥ä¸‹)', emoji: 'âš¡' },
            { value: 'medium', label: 'æ™®é€š (90-120åˆ†)', emoji: 'â°' },
            { value: 'long', label: 'é•·ã‚ (120åˆ†ä»¥ä¸Š)', emoji: 'ğŸï¸' },
            { value: 'any', label: 'æ°—ã«ã—ãªã„', emoji: 'ğŸ¤·' }
          ]
        },
        {
          id: 'setting',
          question: 'èˆå°ãƒ»ä¸–ç•Œè¦³ã¯ï¼Ÿ',
          emoji: 'ğŸŒ',
          options: [
            { value: 'modern', label: 'ç¾ä»£', emoji: 'ğŸ™ï¸' },
            { value: 'past', label: 'éå»', emoji: 'ğŸ›ï¸' },
            { value: 'future', label: 'æœªæ¥', emoji: 'ğŸš€' },
            { value: 'fantasy', label: 'ãƒ•ã‚¡ãƒ³ã‚¿ã‚¸ãƒ¼', emoji: 'ğŸ§™' }
          ]
        },
        {
          id: 'with',
          question: 'èª°ã¨è¦‹ã‚‹ï¼Ÿ',
          emoji: 'ğŸ‘¥',
          options: [
            { value: 'alone', label: 'ä¸€äºº', emoji: 'ğŸ§˜' },
            { value: 'friends', label: 'å‹é”', emoji: 'ğŸ‘¯' },
            { value: 'partner', label: 'æ‹äºº', emoji: 'ğŸ’‘' },
            { value: 'family', label: 'å®¶æ—', emoji: 'ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦' }
          ]
        }
      ];

      const handleAnswer = (questionId, value) => {
        setAnswers(prev => ({ ...prev, [questionId]: value }));
        if (step < questions.length - 1) {
          setTimeout(() => setStep(step + 1), 300);
        }
      };

      const findMovie = async () => {
        setLoading(true);
        try {
          const response = await fetch('/api/movies', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ answers })
          });
          const data = await response.json();
          if (data.error) {
            alert('ã‚¨ãƒ©ãƒ¼: ' + data.error);
          } else {
            setMovie(data);
          }
        } catch (error) {
          alert('ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: ' + error.message);
        } finally {
          setLoading(false);
        }
      };

      const reset = () => {
        setStep(0);
        setAnswers({});
        setMovie(null);
      };

      const currentQuestion = questions[step];
      const allAnswered = Object.keys(answers).length === questions.length;

      if (loading) {
        return (
          <div className="min-h-screen bg-gradient-to-br from-purple-900 via-indigo-900 to-blue-900 flex items-center justify-center">
            <div className="text-center">
              <div className="text-8xl animate-bounce mb-6">ğŸ¬</div>
              <p className="text-white text-2xl font-bold">æ˜ ç”»ã‚’æ¢ã—ã¦ã„ã¾ã™...</p>
            </div>
          </div>
        );
      }

      if (movie) {
        return (
          <div className="min-h-screen bg-gradient-to-br from-purple-900 via-indigo-900 to-blue-900 p-6">
            <div className="max-w-4xl mx-auto">
              <div className="bg-white/10 backdrop-blur-lg rounded-3xl p-8 shadow-2xl">
                <div className="text-center mb-6">
                  <div className="text-6xl mb-4">ğŸ¬</div>
                  <h2 className="text-3xl font-black text-white mb-2">ã‚ãªãŸã«ãŠã™ã™ã‚ã®æ˜ ç”»</h2>
                </div>
                
                {movie.poster && (
                  <img 
                    src={movie.poster} 
                    alt={movie.title}
                    className="w-full max-w-md mx-auto rounded-2xl shadow-xl mb-6"
                  />
                )}
                
                <h3 className="text-5xl font-black text-white mb-4 text-center">{movie.title}</h3>
                
                <div className="flex justify-center gap-4 mb-6 flex-wrap">
                  {movie.year && (
                    <span className="bg-white/20 px-4 py-2 rounded-full text-white font-bold">
                      ğŸ“… {movie.year}å¹´
                    </span>
                  )}
                  {movie.rating && (
                    <span className="bg-yellow-500/30 px-4 py-2 rounded-full text-white font-bold">
                      â­ {movie.rating}
                    </span>
                  )}
                  {movie.runtime && (
                    <span className="bg-blue-500/30 px-4 py-2 rounded-full text-white font-bold">
                      â±ï¸ {movie.runtime}åˆ†
                    </span>
                  )}
                </div>

                {movie.genres && (
                  <p className="text-blue-200 text-center mb-4 font-semibold">
                    ğŸ­ {movie.genres}
                  </p>
                )}
                
                <p className="text-blue-100 text-lg leading-relaxed mb-8">{movie.desc}</p>
                
                <button 
                  onClick={reset}
                  className="w-full bg-gradient-to-r from-yellow-400 to-pink-500 text-white py-4 px-8 rounded-xl font-bold text-xl hover:scale-105 transition-transform"
                >
                  ğŸ”„ ã‚‚ã†ä¸€åº¦è¨ºæ–­ã™ã‚‹
                </button>
              </div>
            </div>
          </div>
        );
      }

      return (
        <div className="min-h-screen bg-gradient-to-br from-purple-900 via-indigo-900 to-blue-900 p-6">
          <div className="max-w-2xl mx-auto">
            <h1 className="text-6xl font-black text-white mb-8 text-center drop-shadow-lg">
              ğŸ¬ æ˜ ç”»è¨ºæ–­
            </h1>

            <div className="mb-6">
              <div className="flex justify-between mb-2">
                <span className="text-white font-bold">è³ªå• {step + 1} / {questions.length}</span>
                <span className="text-white font-bold">{Math.round(((step + 1) / questions.length) * 100)}%</span>
              </div>
              <div className="w-full bg-white/20 rounded-full h-3">
                <div 
                  className="bg-gradient-to-r from-yellow-400 to-pink-500 h-3 rounded-full transition-all duration-500"
                  style={{ width: `${((step + 1) / questions.length) * 100}%` }}
                ></div>
              </div>
            </div>

            <div className="bg-white/10 backdrop-blur-lg rounded-3xl p-10 shadow-2xl">
              <div className="text-center mb-8">
                <div className="text-7xl mb-4 animate-pulse">{currentQuestion.emoji}</div>
                <h2 className="text-4xl font-bold text-white">{currentQuestion.question}</h2>
              </div>

              <div className={`grid gap-4 ${currentQuestion.options.length > 4 ? 'grid-cols-2' : 'grid-cols-2'}`}>
                {currentQuestion.options.map(option => (
                  <button
                    key={option.value}
                    onClick={() => handleAnswer(currentQuestion.id, option.value)}
                    className="p-6 rounded-2xl font-bold bg-white/20 hover:bg-white/30 text-white transform hover:scale-105 transition-all duration-200 shadow-lg"
                  >
                    <div className="text-4xl mb-2">{option.emoji}</div>
                    <div className="text-lg">{option.label}</div>
                  </button>
                ))}
              </div>

              {allAnswered && (
                <button
                  onClick={findMovie}
                  className="w-full mt-8 bg-gradient-to-r from-yellow-400 to-purple-500 text-white py-4 rounded-xl text-xl font-black hover:scale-105 transition-transform shadow-xl animate-pulse"
                >
                  âœ¨ æ˜ ç”»ã‚’è¦‹ã¤ã‘ã‚‹ï¼ ğŸ¬
                </button>
              )}
            </div>
          </div>
        </div>
      );
    }

    ReactDOM.render(<MovieFinderApp />, document.getElementById('root'));
  </script>
</body>
</html>
